<dashboard>
    <label>Dynamic Time Analysis Dashboard</label>
    <fieldset submitButton="false" autoRun="true">
        <input type="time" token="TIME_PICKER">
            <label>Time Picker</label>
            <default>
                <earliest>-24h</earliest>
                <latest>now</latest>
            </default>
        </input>

        <input type="hidden" token="TIME_BUCKET_SPAN">
            <default>1h</default>
            <change>
                <condition match="'$TIME_PICKER.earliest$' >= '-24h@h' AND '$TIME_PICKER.latest$' <= 'now'">
                    <set token="TIME_BUCKET_SPAN">1h</set>
                </condition>
                <condition match="'$TIME_PICKER.earliest$' < '-24h@h' OR '$TIME_PICKER.latest$' > 'now'">
                    <set token="TIME_BUCKET_SPAN">1d</set>
                </condition>
            </change>
        </input>
    </fieldset>

    <row>
        <panel>
            <search id="mainSearch">
                <query>
                    index="someindex" app_name=someappname MESSAGE="message"
                    | dedup SOME_ID
                    | bin _time span=$TIME_BUCKET_SPAN$
                    | stats count by _time, MESSAGE
                </query>
                <option name="refresh.display">progressbar</option>
            </search>

            <!-- Visualization: Time Chart -->
            <chart>
                <title>Message Count Over Time</title>
                <search base="mainSearch">
                    <query>| timechart span=$TIME_BUCKET_SPAN$ count by MESSAGE</query>
                </search>
                <option name="charting.chart">line</option>
            </chart>
        </panel>
    </row>
</dashboard>
